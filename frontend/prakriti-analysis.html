<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
		<title>Prakriti Analysis - AyurvediCure</title>
		<meta name="description" content="Ayurvedic Prakriti Analysis" />
		<link href="img/ayruvedi.png" rel="icon">

		<script>
			if (!localStorage.frenify_skin) {
				localStorage.frenify_skin = 'light';
			}
			if (!localStorage.frenify_panel) {
				localStorage.frenify_panel = '';
			}
			document.documentElement.setAttribute("data-techwave-skin", localStorage.frenify_skin);
			if(localStorage.frenify_panel !== ''){
				document.documentElement.classList.add(localStorage.frenify_panel);
			}
		</script>

		<!-- Google Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com/">
		<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@100;200;300;400;500;600;700;800;900&amp;family=Work+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet">

		<!-- Styles -->
		<link rel="stylesheet" href="css/plugins8a54.css?ver=1.0.0" />
		<link rel="stylesheet" href="css/style8a54.css?ver=1.0.0" />
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				font-family: 'Segoe UI', sans-serif;
				/* use theme variable so page bg matches header/leftpanel */
				background-color: var(--techwave-site-bg-color);
			}

			.center-wrapper {
				max-width: 960px;
				margin: 0 auto;
				padding: 2rem 1rem;
				
			}

			.page-title {
				color: #137300;
				font-size: 2rem;
				font-weight: 700;
				margin-bottom: 12px;
			}

			.card-prakriti {
				border-radius: 12px;
				padding: 18px;
				/*background: #f8f9fa;*/
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
				background-color: var(--techwave-site-bg-color);
			}

			.result-note {
				margin-top: 12px;
			}
		</style>
	</head>

	<body>
		<!-- Moving Submenu -->
		<div class="techwave_fn_fixedsub">
			<ul></ul>
		</div>
		<!-- !Moving Submenu -->

		<!-- Preloader -->
		<div class="techwave_fn_preloader">
			<svg>
				<circle class="first_circle" cx="50%" cy="50%" r="110"></circle>
				<circle class="second_circle" cx="50%" cy="50%" r="110"></circle>
			</svg>
		</div>
		<!-- !Preloader -->

		<!-- top logo/nav similar to other pages (use theme colors) -->
		<nav style="padding:10px 16px; background: var(--techwave-header-bg-color); border-bottom: 1px solid var(--techwave-border-color);">
			<img src="img/ayurvedicure-removebg-preview.png" alt="AyurvediCure" style="height:48px;" />
		</nav>

		<div class="techwave_fn_wrapper">
			<div class="techwave_fn_wrap">
				<!-- HEADER (copied from site template) -->
				<header class="techwave_fn_header">
					<div class="header__left">
						<div class="fn__token_info">
							<span class="token_summary">
								<span class="count">120+</span>
								<span class="text">Happy People</span>
							</span>
							<a href="contact.html" class="token_upgrade techwave_fn_button"><span>Contact Us</span></a>
						</div>
					</div>
					<div class="header__right">
						<div class="fn__nav_bar">
							<div class="bar__item bar__item_search">
								<a href="#" class="item_opener">
									<img src="svg/search.svg" alt="" class="fn__svg">
								</a>
								<div class="item_popup">
									<input type="text" placeholder="Search">
								</div>
							</div>
							<div class="bar__item bar__item_notification has_notification">
								<a href="#" class="item_opener">
									<img src="svg/bell.svg" alt="" class="fn__svg">
								</a>
								<div class="item_popup">
									<div class="ntfc_header">
										<h2 class="ntfc_title">Notifications</h2>
										<a href="#">So Far</a>
									</div>
									<div class="ntfc_list">
										<ul>
											<li>
												<p><a href="notification-single.html">Version 1.0.1 has been launched</a></p>
												<span>34 Min Ago</span>
											</li>
											<li>
												<p><a href="notification-single.html">New Message from Doctor</a></p>
												<span>1 day Ago</span>
											</li>
											<li>
												<p><a href="notification-single.html">Updated Presciption</a></p>
												<span>10 Jul</span>
											</li>
										</ul>
									</div>
								</div>
							</div>
							<div class="bar__item bar__item_fullscreen">
								<a href="#" class="item_opener">
									<img src="svg/fullscreen.svg" alt="" class="fn__svg f_screen">
									<img src="svg/smallscreen.svg" alt="" class="fn__svg s_screen">
								</a>
							</div>
							<div class="bar__item bar__item_language">
								<a href="#" class="item_opener">
									<img src="svg/language.svg" alt="" class="fn__svg">
								</a>
								<div class="item_popup">
									<ul>
										<li>
											<span class="active">English</span>
										</li>
									</ul>
								</div>
							</div>
							<div class="bar__item bar__item_skin">
								<a href="#" class="item_opener">
									<img src="svg/sun.svg" alt="" class="fn__svg light_mode">
									<img src="svg/moon.svg" alt="" class="fn__svg dark_mode">
								</a>
							</div>
							<div class="bar__item bar__item_user">
								<a href="#" class="user_opener">
									<img src="img/user/user.png" alt="">
								</a>
								<div class="item_popup">
									<div class="user_profile">
										<div class="user_img">
											<img src="img/user/user.png" alt="">
										</div>
										<div class="user_info">
											<h2 class="user_name">John Cena<span>New</span></h2>
											<p><a href="mailto:johncena@gmail.com" class="user_email">johncena@gmail.com</a></p>
										</div>
									</div>
									<div class="user_nav">
										<ul>
											<li>
												<a href="user-profile.html">
													<span class="icon"><img src="svg/person.svg" alt="" class="fn__svg"></span>
													<span class="text">Profile</span>
												</a>
											</li>
											<li>
												<a href="user-settings.html">
													<span class="icon"><img src="svg/setting.svg" alt="" class="fn__svg"></span>
													<span class="text">Settings</span>
												</a>
											</li>
											<li>
												<a href="sign-in.html">
													<span class="icon"><img src="svg/logout.svg" alt="" class="fn__svg"></span>
													<span class="text">Log Out</span>
												</a>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</header>
				<!-- LEFT PANEL (copied from site template) -->
				<div class="techwave_fn_leftpanel">
					<div class="mobile_extra_closer"></div>
					<div class="leftpanel_logo">
						<a href="index.html" class="fn_logo">
							<span class="full_logo">
								<img src="img/ayurvedicure-removebg-preview.png" alt="" class="desktop_logo">
								<img src="img/ayurvedicure-removebg-preview.png" alt="" class="retina_logo">
							</span>
							<span class="short_logo">
								<img src="img/ayruvedi.png" alt="" class="desktop_logo">
								<img src="img/ayruvedi.png" alt="" class="retina_logo">
							</span>
						</a>
						<a href="#" class="fn__closer fn__icon_button desktop_closer">
							<img src="svg/arrow.svg" alt="" class="fn__svg">
						</a>
						<a href="#" class="fn__closer fn__icon_button mobile_closer">
							<img src="svg/arrow.svg" alt="" class="fn__svg">
						</a>
					</div>
					<div class="leftpanel_content">
						<div class="nav_group">
							<h2 class="group__title">Start Here</h2>
							<ul class="group__list">
								<li>
									<a href="user-login.html" class="fn__tooltip menu__item" data-position="right" title="Home">
										<span class="icon"><img src="svg/home.svg" alt="" class="fn__svg"></span>
										<span class="text">Home</span>
									</a>
								</li>
								<li>
									<a href="about-us.html" class="fn__tooltip menu__item" data-position="right" title="About Us">
										<span class="icon"><img src="svg/person.svg" alt="" class="fn__svg"></span>
										<span class="text">About Us</span>
									</a>
								</li>
								<li>
									<a href="blogs.html" class="fn__tooltip menu__item" data-position="right" title="Finetuned Models">
										<span class="icon"><img src="svg/cube.svg" alt="" class="fn__svg"></span>
										<span class="text">Blogs</span>
									</a>
								</li>
							</ul>
						</div>
						<div class="nav_group">
							<h2 class="group__title">Consultation</h2>
							<ul class="group__list">
								<li>
									<a href="ai-chat-bot.html" class="fn__tooltip menu__item" data-position="right" title="AI Doctor">
										<span class="icon"><img src="svg/icons8-chatgpt.svg"  alt="" class="fn__svg"></span>
										<span class="text">AI Doctor</span>
									</a>
								</li>
								<li>
									<a href="human-doctor.html" class="fn__tooltip menu__item" data-position="right" title="Human Doctor">
										<span class="icon"><img src="svg/doctor-svgrepo-com.svg" alt="" class="fn__svg"></span>
										<span class="text">Human Doctor</span>
									</a>
								</li>
								<li>
									<a href="prakriti-analysis.html" class="fn__tooltip menu__item" data-position="right" title="Human Doctor">
										<span class="icon"><img src="svg/doctor-svgrepo-com.svg" alt="" class="fn__svg"></span>
										<span class="text">Prakriti Analysis</span>
									</a>
								</li>
							</ul>
						</div>
						<div class="nav_group">
					<h2 class="group__title"></h2>
					<ul class="group__list">
						
						
						<li>
							<a href="sign-in.html" class="fn__tooltip menu__item" data-position="right" title="Log Out">
								<span class="icon"><img src="svg/logout.svg" alt="" class="fn__svg"></span>
								<span class="text">Log Out</span>
							</a>
						</li>
					</ul>
				</div>
					</div>
				</div>
				<!-- /LEFT PANEL -->
				<div class="techwave_fn_content">
					<div class="techwave_fn_page">
						<div class="center-wrapper">
							<h1 class="page-title">Discover Your Prakriti</h1>

							<div class="card-prakriti">
								<form id="prakritiForm" class="row g-3">
									<div class="col-md-6">
										<label class="form-label">Body Frame</label>
										<select class="form-select" name="frame">
											<option value="vata">Thin and light</option>
											<option value="pitta">Medium, muscular</option>
											<option value="kapha">Broad, heavy</option>
										</select>
									</div>

									<div class="col-md-6">
										<label class="form-label">Skin Type</label>
										<select class="form-select" name="skin">
											<option value="vata">Dry and rough</option>
											<option value="pitta">Sensitive, reddish</option>
											<option value="kapha">Smooth, oily</option>
										</select>
									</div>

									<div class="col-md-6">
										<label class="form-label">Temperament</label>
										<select class="form-select" name="temperament">
											<option value="vata">Anxious, talkative</option>
											<option value="pitta">Irritable, intense</option>
											<option value="kapha">Calm, patient</option>
										</select>
									</div>

									<div class="col-md-6">
										<label class="form-label">Appetite</label>
										<select class="form-select" name="appetite">
											<option value="vata">Irregular</option>
											<option value="pitta">Strong, sharp</option>
											<option value="kapha">Slow, low</option>
										</select>
									</div>

									<div class="col-12">
										<button type="button" id="submitPrakriti" class="btn btn-success">Analyze Prakriti</button>
										<button type="reset" class="btn btn-outline-secondary ms-2">Reset</button>
									</div>
								</form>

								<div id="prakritiResult" class="mt-4" style="display:none;">
									<h4 class="text-success">You are predominantly <span id="prakritiType"></span>!</h4>
									<div class="result-note">You can view personalised recommendations on the result page.</div>
									<a id="viewRecommendations" href="prakriti-result.html" class="btn btn-primary mt-2">View Recommendations</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Scripts -->
		<script src="js/jquery8a54.js?ver=1.0.0"></script>
		<script src="js/plugins8a54.js?ver=1.0.0"></script>
		<script src="js/init8a54.js?ver=1.0.0"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			// Analyze and store result so result page can read it
			document.getElementById('submitPrakriti').addEventListener('click', async function () {
				const form = document.forms['prakritiForm'];
				let scores = { vata: 0, pitta: 0, kapha: 0 };
				['frame', 'skin', 'temperament', 'appetite'].forEach((q) => {
					const val = form[q].value;
					if (val && scores.hasOwnProperty(val)) scores[val]++;
				});

				let dominant = Object.keys(scores).reduce((a, b) => (scores[a] > scores[b] ? a : b));
				const pretty = dominant.charAt(0).toUpperCase() + dominant.slice(1);
				document.getElementById('prakritiType').textContent = pretty;
				document.getElementById('prakritiResult').style.display = 'block';

				// Persist selection so prakriti-result.html can read it
				try {
					localStorage.setItem('prakriti', dominant);
					localStorage.setItem('prakritiScores', JSON.stringify(scores));
				} catch (e) {
					console.warn('Could not save prakriti to localStorage', e);
				}

				// Save to database via API
				const token = localStorage.getItem('authToken');
				console.log('Token exists:', !!token);
				
				if (token) {
					try {
						console.log('Sending prakriti data to /api/prakriti/submit...');
						console.log('Data:', { prakritiType: dominant, scores: scores });
						
						const response = await fetch('/api/prakriti/submit', {
							method: 'POST',
							headers: {
								'Authorization': `Bearer ${token}`,
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({
								prakritiType: dominant,
								scores: scores
							})
						});

						console.log('Response status:', response.status);
						console.log('Response headers:', response.headers.get('content-type'));

						// Check if response is JSON
						const contentType = response.headers.get('content-type');
						if (!contentType || !contentType.includes('application/json')) {
							const text = await response.text();
							console.error('Response is not JSON:', text.substring(0, 200));
							throw new Error('Server returned HTML instead of JSON. API endpoint may not be configured correctly.');
						}

						const data = await response.json();
						console.log('Response data:', data);

						if (response.ok) {
							console.log('✅ Prakriti analysis saved to database:', data);
							
							// Show success message
							const resultDiv = document.getElementById('prakritiResult');
							const successMsg = document.createElement('div');
							successMsg.className = 'alert alert-success mt-2';
							successMsg.innerHTML = `
								<strong>✅ Success!</strong> Your prakriti analysis has been saved. 
								Follow-up scheduled for: ${new Date(data.followUpDate).toLocaleDateString()}
								
							`;
							resultDiv.appendChild(successMsg);
						} else {
							console.error('Failed to save prakriti analysis. Status:', response.status);
							console.error('Error data:', data);
							alert('⚠️ Analysis completed but not saved to database: ' + (data.message || 'Unknown error'));
						}
					} catch (error) {
						console.error('Error saving prakriti to database:', error);
						console.error('Error details:', error.message);
						alert('⚠️ Analysis completed but not saved to database.\nError: ' + error.message + '\nCheck browser console (F12) for details.');
					}
				} else {
					console.warn('No auth token found - result not saved to database');
					alert('⚠️ You are not logged in. Result not saved to database.\nPlease sign in to save your analysis.');
				}

				// Optionally navigate to result page after a short delay
				// window.location.href = 'prakriti-result.html';
			});
		</script>
		<script type="text/javascript" src="js/auth.js"></script>
		<script>initAuth(true);</script>
	</body>
</html>
